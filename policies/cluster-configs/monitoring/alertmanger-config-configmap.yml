apiVersion: v1
kind: ConfigMap
metadata:
  name: user-alertmanager-config
  namespace: openshift-monitoring
data:
  alertmanager-config: |
    global:
      resolve_timeout: 5m
    inhibit_rules:
      - equal:
          - namespace
          - alertname
        source_match:
          severity: critical
        target_match_re:
          severity: warning|info
      - equal:
          - namespace
          - alertname
        source_match:
          severity: warning
        target_match_re:
          severity: info
    receivers:
      - name: Default
      - name: Watchdog
        webhook_configs:
          - url: http://alert.example.com:10001/probe/webhook/cem
      - name: Critical
        webhook_configs:
          - url: http://alert.example.com:10001/probe/webhook/cem
      - name: Polaris
        webhook_configs:
          - url: https://user-prometheus.apps.{{ fromClusterClaim "name" }}.example.com/alertmanager
            send_resolved: true
    route:
      group_by:
        - ...
      group_wait: '2s'
      group_interval: 5m
      receiver: Default
      repeat_interval: 12h
      routes:
        - receiver: Watchdog
          match:
            alertname: Watchdog
        - receiver: Critical
          match:
            severity: critical
        - receiver: Polaris
          matchers:
            - namespace =~ "user-dev-apps-.*|user-platform-.*|user-tooling-.*"