---
apiVersion: policy.open-cluster-management.io/v1
kind: ConfigurationPolicy
metadata:
  name: clusterlogging
spec:
  remediationAction: enforce
  severity: high
  object-templates-raw: |
    - complianceType: musthave
      objectDefinition:
        apiVersion: "observability.openshift.io/v1"
        kind: ClusterLogForwarder
        metadata:
          name: collector
          namespace: openshift-logging
        spec:
          serviceAccount:
            name: collector
          managementState: Managed

          inputs:
            - name: app-logs
              type: application
              application:
                tuning:
                  rateLimitPerContainer:
                    - maxRecordsPerSecond: 500
            - name: infra-logs
              type: infrastructure
              infrastructure:
                sources:
                  - node
                  - container
            - name: audit-logs
              type: audit
              audit:
                sources:
                  - kubeAPI
                  - openshiftAPI

          outputs:
          - name: default-lokistack
            type: lokiStack
            lokiStack:
              target:
                name: logging-loki
                namespace: openshift-logging
              authentication:
                token:
                  from: serviceAccount
            tls:
              ca:
                key: service-ca.crt
                configMapName: openshift-service-ca.crt
          pipelines:
          - name: default-logstore
            outputRefs:
            - default-lokistack
            inputRefs:
            - application
            - infrastructure
            - audit