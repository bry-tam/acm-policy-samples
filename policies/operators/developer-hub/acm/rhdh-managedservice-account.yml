---
object-templates-raw: |
  {{- range (lookup "cluster.open-cluster-management.io/v1" "ManagedCluster" "" "").items }}
    {{- $mc_name := (printf "rhdh-%s" .metadata.name) }}

  - complianceType: musthave
    objectDefinition:
      apiVersion: authentication.open-cluster-management.io/v1alpha1
      kind: ManagedServiceAccount
      metadata:
        name: '{{ $mc_name }}'
        namespace: '{{ .metadata.namespace }}'
      spec:
        rotation: {}

  - complianceType: mustonlyhave
    objectDefinition:
      apiVersion: rbac.open-cluster-management.io/v1alpha1
      kind: ClusterPermission
      metadata:
              name: '{{ $mc_name }}'
              namespace: '{{ .metadata.namespace }}'
      spec:
        clusterRole:
          rules:
          - apiGroups: ["*"]
            resources: ["*"]
            verbs: ["get", "list", "watch"]
        clusterRoleBinding:
          subject:
            apiGroup: authentication.open-cluster-management.io
            kind: ManagedServiceAccount
            name: '{{ $mc_name }}'
  {{- end }}
