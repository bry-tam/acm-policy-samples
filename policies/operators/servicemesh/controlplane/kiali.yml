---
apiVersion: kiali.io/v1alpha1
kind: Kiali
metadata:
  name: kiali-user-workload-monitoring
  namespace: istio-system
spec:
  deployment:
    istio_namespace: istio-system
    logger:
      log_level: debug

  external_services:
    prometheus:
      auth:
        type: bearer
        use_kiali_token: true
      thanos_proxy:
        enabled: true
      url: https://thanos-querier.openshift-monitoring.svc.cluster.local:9091

    istio:
      ingress_gateway_namespace: "istio-ingress"

    tracing:
      enabled: true 
      provider: tempo 
      use_grpc: false
      internal_url: https://tempo-ossm-tempostack-gateway.tracing-system.svc.cluster.local:8080/api/traces/v1/default/tempo 
      external_url: 'https://{{ dig "spec" "host" "" (lookup "route.openshift.io/v1" "Route" "tracing-system" "tempo-ossm-tempostack-gateway") }}'
      health_check_url: 'https://{{ dig "spec" "host" "" (lookup "route.openshift.io/v1" "Route" "tracing-system" "tempo-ossm-tempostack-gateway") }}'
      auth: 
        ca_file: /var/run/secrets/kubernetes.io/serviceaccount/service-ca.crt
        insecure_skip_verify: false
        type: bearer
        use_kiali_token: true
      tempo_config:
         url_format: "jaeger"

    grafana: 
      enabled: false