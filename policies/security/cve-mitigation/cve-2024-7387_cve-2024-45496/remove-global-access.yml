---
object-templates-raw: |
  {{- $bindingList := list
                        (lookup "rbac.authorization.k8s.io/v1" "ClusterRoleBinding" "" "system:build-strategy-docker-binding")
                        (lookup "rbac.authorization.k8s.io/v1" "ClusterRoleBinding" "" "system:build-strategy-source-binding")
  }}

  {{- range $crb := $bindingList }}
  - complianceType: mustonlyhave
    objectDefinition:
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRoleBinding
      metadata:
        annotations:
          rbac.authorization.kubernetes.io/autoupdate: "false"
        name: {{ $crb.metadata.name }}
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: {{ $crb.roleRef.name }}
      subjects:
      {{- range $sub := $crb.subjects }}
        {{- if not (eq  $sub.name "system:authenticated") }}
        - {{ $sub | toRawJson | toLiteral }}
        {{- end }}
      {{- end }}
  {{- end }}


  {{- $clusterRoleList := list
                        (lookup "rbac.authorization.k8s.io/v1" "ClusterRole" "" "admin")
                        (lookup "rbac.authorization.k8s.io/v1" "ClusterRole" "" "edit")
  }}

  {{- range $cr := $clusterRoleList }}
  - complianceType: mustonlyhave
    objectDefinition:
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRole
      metadata:
        name: {{ $cr.metadata.name }}
      rules:
      {{- range $rule := $cr.rules }}
        {{- if or (not (has "build.openshift.io" $rule.apiGroups)) (not (has "buildconfigs" $rule.resources)) }}
        - {{ $rule | toRawJson | toLiteral }}
        {{- else }}
        - apiGroups:
          {{- range $rule.apiGroups }}
            - {{ . | quote }}
          {{- end }}
          resources:
          {{- range $r := $rule.resources }}
            {{- if not (eq $r "builds" "builds/source" "builds/docker" "builds/custom") }}
            - {{ $r }}
            {{- end }}
          {{- end }}
          verbs:
          {{- range $rule.verbs }}
            - {{ . }}
          {{- end }}
        {{- end }}
      {{- end }}
  {{- end }}
