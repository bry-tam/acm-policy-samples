---
object-templates-raw: |
  {{hub- $servers := list hub}}
  {{hub- range $mcv := (lookup "view.open-cluster-management.io/v1beta1" "ManagedClusterView" "" "" "coredns-service").items hub}}
    {{hub- $server := (index $mcv.status.result.status.loadBalancer.ingress 0).hostname hub}}
    {{hub- $servers = append $servers (printf "%s:53" $server) hub}}
  {{hub- end hub}}

  - complianceType: mustonlyhave
    objectDefinition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: core-dns
        namespace: kuadrant-coredns
      type: kuadrant.io/coredns
      data:
        NAMESERVERS: '{{hub ($servers | join ",") | base64enc hub}}'
        ZONES: '{{ (printf "*.global.%s" (lookup "config.openshift.io/v1" "Ingress" "" "cluster").spec.domain) | base64enc }}'
